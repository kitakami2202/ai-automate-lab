---
const navItems = [
  { label: 'ホーム', href: '/' },
  { label: 'GAS', href: '/category/gas/' },
  { label: 'Discord Bot', href: '/category/discord-bot/' },
  { label: 'AI API', href: '/category/ai-api/' },
  { label: 'ノーコード', href: '/category/no-code/' },
  { label: 'フレームワーク', href: '/category/frameworks/' },
  { label: '用語集', href: '/glossary/' },
  { label: 'サイトについて', href: '/about/' },
];

const currentPath = Astro.url.pathname;
---

<header class="sticky top-0 z-50 bg-white/80 backdrop-blur-sm border-b border-gray-200">
  <div class="container flex items-center justify-between h-16">
    <a href="/" class="text-xl font-bold text-brand no-underline hover:no-underline">
      AI Automate Lab
    </a>

    <!-- Desktop Nav -->
    <nav class="hidden md:flex items-center gap-6">
      {navItems.map((item) => (
        <a
          href={item.href}
          class:list={[
            'text-sm font-medium no-underline hover:text-brand transition-colors',
            currentPath === item.href || (item.href !== '/' && currentPath.startsWith(item.href.replace(/\/$/, ''))) ? 'text-brand' : 'text-gray-600',
          ]}
        >
          {item.label}
        </a>
      ))}
      <button
        id="search-btn"
        class="p-2 text-gray-500 hover:text-brand transition-colors"
        aria-label="検索を開く"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
      </button>
    </nav>

    <!-- Mobile Menu Button -->
    <div class="flex items-center gap-2 md:hidden">
      <button
        id="search-btn-mobile"
        class="p-2 text-gray-500 hover:text-brand transition-colors"
        aria-label="検索を開く"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
      </button>
      <button
        id="mobile-menu-btn"
        class="p-2 text-gray-600"
        aria-label="メニューを開く"
      >
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
      </svg>
    </button>
    </div>
  </div>

  <!-- Mobile Nav -->
  <nav id="mobile-menu" class="hidden md:hidden border-t border-gray-200 bg-white">
    <div class="container py-4 flex flex-col gap-3">
      {navItems.map((item) => (
        <a
          href={item.href}
          class:list={[
            'text-sm font-medium no-underline hover:text-brand',
            currentPath === item.href ? 'text-brand' : 'text-gray-600',
          ]}
        >
          {item.label}
        </a>
      ))}
    </div>
  </nav>
</header>

<!-- Search Modal -->
<div id="search-modal" class="hidden fixed inset-0 z-[60] bg-black/50 backdrop-blur-sm">
  <div class="container max-w-2xl mx-auto mt-20 bg-white rounded-xl shadow-2xl p-6">
    <div class="flex items-center justify-between mb-4">
      <p class="text-sm font-bold text-gray-700">記事を検索</p>
      <button id="search-close" class="p-1 text-gray-400 hover:text-gray-600" aria-label="閉じる">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
    <div id="search-modal-content"></div>
  </div>
</div>

<link href="/pagefind/pagefind-ui.css" rel="stylesheet" />
<script is:inline src="/pagefind/pagefind-ui.js"></script>
<script is:inline>
(function() {
  var modal = document.getElementById('search-modal');
  var initialized = false;

  function openSearch() {
    if (!initialized) {
      new PagefindUI({
        element: '#search-modal-content',
        showSubResults: true,
        translations: {
          placeholder: '記事を検索...',
          zero_results: '「[SEARCH_TERM]」に一致する記事が見つかりませんでした',
        },
      });
      initialized = true;
    }
    modal.classList.remove('hidden');
    setTimeout(function() {
      var input = modal.querySelector('.pagefind-ui__search-input');
      if (input) input.focus();
    }, 100);
  }

  function closeSearch() {
    modal.classList.add('hidden');
  }

  document.getElementById('search-btn')?.addEventListener('click', openSearch);
  document.getElementById('search-btn-mobile')?.addEventListener('click', openSearch);
  document.getElementById('search-close')?.addEventListener('click', closeSearch);
  modal?.addEventListener('click', function(e) {
    if (e.target === modal) closeSearch();
  });
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && !modal.classList.contains('hidden')) closeSearch();
    if ((e.metaKey || e.ctrlKey) && e.key === 'k') { e.preventDefault(); openSearch(); }
  });

  var menuBtn = document.getElementById('mobile-menu-btn');
  var menu = document.getElementById('mobile-menu');
  menuBtn?.addEventListener('click', function() {
    menu?.classList.toggle('hidden');
  });
  menu?.querySelectorAll('a').forEach(function(link) {
    link.addEventListener('click', function() {
      menu?.classList.add('hidden');
    });
  });
})();
</script>
