---
import SEOHead from '../components/SEOHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import CookieConsent from '../components/CookieConsent.astro';
import '../styles/global.css';

export interface Props {
  title: string;
  description: string;
  ogImage?: string;
  type?: 'website' | 'article';
  publishedTime?: string;
  modifiedTime?: string;
  jsonLd?: string | string[];
}

const { title, description, ogImage, type, publishedTime, modifiedTime, jsonLd } = Astro.props;
---

<!doctype html>
<html lang="ja">
  <head>
    <SEOHead
      title={title}
      description={description}
      ogImage={ogImage}
      type={type}
      publishedTime={publishedTime}
      modifiedTime={modifiedTime}
      jsonLd={jsonLd}
    />
  </head>
  <body class="min-h-screen flex flex-col">
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-2 focus:left-2 focus:z-[100] focus:bg-brand focus:text-white focus:px-4 focus:py-2 focus:rounded">
      本文へスキップ
    </a>
    <Header />
    <main id="main-content" class="flex-1">
      <slot />
    </main>
    <Footer />
    <CookieConsent />

    <!-- Table Responsive Wrapper -->
    <script is:inline>
    (function() {
      document.querySelectorAll('.article-content table').forEach(function(table) {
        if (table.parentElement && table.parentElement.classList.contains('table-wrapper')) return;
        var wrapper = document.createElement('div');
        wrapper.className = 'table-wrapper';
        table.parentNode.insertBefore(wrapper, table);
        wrapper.appendChild(table);
      });
    })();
    </script>

    <!-- Code Copy Button -->
    <script is:inline>
    (function() {
      var CLIPBOARD_SVG = '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>';
      var CHECK_SVG = '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>';
      document.querySelectorAll('.article-content pre').forEach(function(pre) {
        var btn = document.createElement('button');
        btn.className = 'copy-btn';
        btn.innerHTML = CLIPBOARD_SVG;
        btn.setAttribute('aria-label', 'コードをコピー');
        btn.addEventListener('click', function() {
          var code = pre.querySelector('code');
          var text = code ? code.textContent : pre.textContent;
          navigator.clipboard.writeText(text || '').then(function() {
            btn.innerHTML = CHECK_SVG;
            btn.classList.add('copied');
            setTimeout(function() {
              btn.innerHTML = CLIPBOARD_SVG;
              btn.classList.remove('copied');
            }, 2000);
          });
        });
        pre.appendChild(btn);
      });
    })();
    </script>

    <!-- Back to Top Button -->
    <button
      id="back-to-top"
      class="fixed bottom-16 lg:bottom-6 right-6 z-50 w-10 h-10 bg-brand text-white rounded-full shadow-lg hover:bg-brand-hover transition-all opacity-0 pointer-events-none"
      aria-label="ページの先頭へ戻る"
    >
      <svg class="w-5 h-5 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
      </svg>
    </button>
    <script is:inline>
    (function() {
      var btn = document.getElementById('back-to-top');
      if (!btn) return;
      window.addEventListener('scroll', function() {
        if (window.scrollY > 300) {
          btn.style.opacity = '1';
          btn.style.pointerEvents = 'auto';
        } else {
          btn.style.opacity = '0';
          btn.style.pointerEvents = 'none';
        }
      }, { passive: true });
      btn.addEventListener('click', function() {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
    })();
    </script>
  </body>
</html>
