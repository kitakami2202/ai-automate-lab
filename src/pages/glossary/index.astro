---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Breadcrumb from '../../components/Breadcrumb.astro';
import {
  glossaryTerms,
  glossaryCategoryLabels,
  glossaryCategoryBadgeColors,
  type GlossaryCategory,
} from '../../data/glossary';
import { generateGlossaryIndexJsonLd } from '../../utils/jsonld';

const categories = Object.keys(glossaryCategoryLabels) as GlossaryCategory[];
const jsonLd = generateGlossaryIndexJsonLd();
---

<BaseLayout
  title="用語集 | AI Automate Lab"
  description="AI・自動化に関する用語集。API、GAS、LLM、Webhookなど、業務自動化でよく使われる専門用語をわかりやすく解説します。"
  jsonLd={jsonLd}
>
  <div class="container py-10">
    <Breadcrumb items={[{ name: '用語集', url: '/glossary/' }]} />

    <h1 class="text-3xl font-bold mb-4">用語集</h1>
    <p class="text-gray-600 mb-8">
      AI・業務自動化でよく使われる用語を{glossaryTerms.length}件まとめました。各用語をクリックすると詳しい解説を確認できます。
    </p>

    <div class="flex flex-wrap gap-2 mb-8" id="category-filters">
      <button
        class="text-sm px-3 py-1.5 rounded-full bg-brand text-white border border-brand"
        data-category="all"
      >
        すべて ({glossaryTerms.length})
      </button>
      {categories.map((cat) => {
        const count = glossaryTerms.filter((t) => t.category === cat).length;
        return (
          <button
            class="text-sm px-3 py-1.5 rounded-full border border-gray-200 text-gray-600 hover:bg-gray-50"
            data-category={cat}
          >
            {glossaryCategoryLabels[cat]} ({count})
          </button>
        );
      })}
    </div>

    <div class="space-y-4" id="glossary-list">
      {glossaryTerms.map((item) => (
        <a
          href={`/glossary/${item.slug}/`}
          class="block border border-gray-200 rounded-lg p-5 hover:shadow-sm hover:border-brand/30 transition-all no-underline"
          data-category={item.category}
        >
          <div class="flex flex-wrap items-baseline gap-3 mb-2">
            <h2 class="text-lg font-bold text-gray-800">{item.term}</h2>
            <span class="text-sm text-gray-500">({item.reading})</span>
            <span
              class={`text-xs px-2 py-0.5 rounded ${glossaryCategoryBadgeColors[item.category]}`}
            >
              {glossaryCategoryLabels[item.category]}
            </span>
          </div>
          <p class="text-gray-600 leading-relaxed">{item.description}</p>
        </a>
      ))}
    </div>
  </div>
</BaseLayout>

<script is:inline>
(function () {
  var filters = document.getElementById('category-filters');
  var items = document.querySelectorAll('#glossary-list > a');
  if (!filters) return;

  filters.addEventListener('click', function (e) {
    var btn = e.target.closest('button');
    if (!btn) return;
    var cat = btn.getAttribute('data-category');

    // Update active state
    filters.querySelectorAll('button').forEach(function (b) {
      b.className = 'text-sm px-3 py-1.5 rounded-full border border-gray-200 text-gray-600 hover:bg-gray-50';
    });
    btn.className = 'text-sm px-3 py-1.5 rounded-full bg-brand text-white border border-brand';

    // Filter items
    items.forEach(function (item) {
      if (cat === 'all' || item.getAttribute('data-category') === cat) {
        item.style.display = '';
      } else {
        item.style.display = 'none';
      }
    });
  });
})();
</script>
