# リファインメントブリーフ: discord-attendance

## 基本情報
- 対象ファイル: src/content/articles/discord-bot/discord-attendance.md
- 監査日: 2026-02-12
- 総合スコア: 75/100
- 判定: **REFINE**

## スコアサマリ

| カテゴリ | スコア | 主な減点理由 |
|---------|--------|-------------|
| コンテンツ品質 | 16/20 | Discord側の設定手順がほぼ省略、GAS Webアプリ公開セクションが見出しのみ、月次集計の出勤日数が未実装 |
| SEO/AEO品質 | 14/20 | description 111文字で120文字未満（CLAUDE.mdルール違反）、FAQ3個で最低ライン、副KW「Discord 出退勤」がH2見出しに未配置 |
| 内部リンク・導線 | 16/20 | 同カテゴリ8記事中2記事にしかリンクなし、他記事からの被リンクゼロ、末尾リンクが羅列的 |
| 可読性・文体 | 16/20 | H3がH2なしで出現（構造違反）、専門用語（GAS, Webhook, doPost等）の初出時定義不足 |
| 鮮度・正確性 | 13/20 | 料金「0円」の時点表記なし・公式URLなし、Discord側からのリクエスト送信手順不足で読者が再現困難 |

## セクション別判定

| セクション | 行 | 判定 | 理由 |
|-----------|-----|------|------|
| frontmatter | L1-29 | **IMPROVE** | description 111文字→120-160文字に拡張必須。FAQ 3個→4-5個に増量推奨 |
| 導入部（冒頭+前提表） | L31-45 | **IMPROVE** | Layer 1ピラーへの導線あり（良好）。ただし `### この記事の前提` がH2外に出現する構造違反。専門用語初出定義なし |
| H2-1: この記事で作るもの | L47-55 | **KEEP** | 定義文あり、機能比較表あり。構成良好 |
| H2-2: 準備・スプレッドシートの作成 | L57-70 | **REWRITE** | 「勤怠記録」シートの列構成は良好。しかしGAS Webアプリ公開セクションが見出し+1行で実質空。Discord Webhook URL取得手順がゼロ |
| H2-3: 実装手順 | L71-207 | **IMPROVE** | 3つのGASコードは動作するが、DiscordからdoPostをトリガーする方法（Discord Bot/Webhookの設定手順）が完全に欠落。notifyDiscord関数をdoPost内からどう呼ぶかの接続も不明確。月次集計の出勤日数カラムが空文字 |
| H2-4: 動作確認・トラブルシューティング | L209-216 | **IMPROVE** | 表形式は良好だが冒頭の定義文なし。動作確認の具体手順（テスト打刻→スプレッドシート確認のステップ）がない |
| H2-5: 応用・カスタマイズ例 | L218-224 | **IMPROVE** | 3項目は妥当だが具体性が薄い（各1行）。同クラスター記事への横展開リンクがない |

## リファイン指示

### 優先度1: descriptionの120-160文字への拡張（CLAUDE.mdルール違反修正）

**現状:** 111文字でCLAUDE.mdの「120-160文字」ルールに違反。

**方向性:**
- 現在: 「DiscordのスラッシュコマンドとGASで勤怠管理Botを構築する方法を解説。出勤・退勤の打刻をDiscordから行い、スプレッドシートに自動記録。月次の勤務時間集計まで、コピペで動くコード付きで約60分で構築できます。」(111文字)
- 改善案: secondary_kw「勤怠 スプレッドシート」を強化しつつ120文字以上に調整。例えば「中小企業のリモートワーク勤怠管理に」などの修飾句を追加

### 優先度2: Discord側の設定手順・GAS Webアプリ公開手順の補完（コンテンツ品質+再現性）

**現状:** GASのコードは掲載されているが、Discordからどうリクエストを送るかの手順が完全に欠落している。

**方向性:**
- H2-2「準備」セクション内に以下を追加:
  - Discord Webhook URL取得手順（サーバー設定→連携サービス→Webhook→新しいWebhook）
  - GAS Webアプリの公開手順を具体化（現在L130-134に3ステップあるが、セクション「GAS Webアプリの公開」（L67-69）が見出しだけで空。どちらかに統合）
- H2-3「実装手順」内に以下を追加:
  - DiscordでメッセージをトリガーにGAS WebアプリのURLへPOSTする方法（Discord Botのメッセージイベント処理、またはサードパーティ連携）
  - doPostとnotifyDiscordの接続コード（doPost内でnotifyDiscordを呼び出す1行を追加）

### 優先度3: H3構造の修正（Markdown構造違反）

**現状:** `### この記事の前提` がどのH2にも属さず孤立。

**方向性:**
- 前提表をH2-1「この記事で作るもの」の先頭に移動する、または
- 前提表のH3見出しを削除してH2の前の導入ブロック（表のみ）にする

### 優先度4: FAQ 4-5個への増量（SEO/AEO強化）

**現状:** FAQ 3個で最低ライン。AEO（AI Engine Optimization）の観点では4-5個が望ましい。

**追加候補:**
- 「既存の勤怠管理システムとの違いは？」→ 無料・カスタマイズ自由・Discord常用チームに最適、という差別化ポイント
- 「日をまたぐ深夜勤務にも対応できますか？」→ トラブルシューティング表で触れているが、FAQとしても重要な検索意図

### 優先度5: 専門用語の初出時定義追加（可読性）

**現状:** 前提記事へのリンクはあるが、この記事単体で読む読者への配慮が不足。

**追加すべき定義:**

| 用語 | 初出箇所 | 追加すべき定義 |
|------|---------|---------------|
| GAS | L34 導入部 | GAS（Google Apps Script、Googleが提供する無料のスクリプト実行環境） |
| Webhook | L59 準備 | Webhook（外部サービスへHTTPリクエストを自動送信する仕組み） |
| doPost | L82 ステップ1 | doPost（GAS Webアプリが外部からのPOSTリクエストを受け取る関数） |
| Embed | L148 ステップ2 | Embed（タイトル・色・フィールドを持つDiscordのリッチメッセージ形式） |
| スクリプトプロパティ | L145 ステップ2 | スクリプトプロパティ（GASでAPIキー等の秘密情報を安全に保管する仕組み） |

### 優先度6: 内部リンクの拡充（内部リンク・導線）

**現状:** 同カテゴリ8記事中2記事にしかリンクなし。他記事のrelatedArticlesにもdiscord-attendanceが含まれていない。

**方向性:**
- 応用セクションに同クラスター記事への横展開リンクを追加:
  - 「スラッシュコマンドで打刻したい場合は、[Discordスラッシュコマンド実装ガイド](/articles/discord-bot/discord-slash-commands)で手順を解説しています」
  - 「勤怠データをスプレッドシートDBとして本格的に管理する方法は、[DiscordスプレッドシートDB連携](/articles/discord-bot/discord-spreadsheet-db)をご覧ください」
- 末尾の羅列的リンクを本文中に自然に分散させる
- 関連する他記事（discord-bot-overview, discord-spreadsheet-db等）のrelatedArticlesにdiscord-attendanceを追加することも検討

### 優先度7: 料金情報の時点表記と公式URL（鮮度・正確性）

**現状:** 前提表で「0円（GAS・Discord無料枠内）」とあるが時点表記なし。

**方向性:**
- 前提表の費用行: 「0円（GAS・Discord無料枠内、2026年2月時点）」
- GAS無料枠の公式URLリンク追加: [Google Apps Script quotas](https://developers.google.com/apps-script/guides/services/quotas)
- Discord無料プランでのWebhook利用可能である旨とDiscord公式URLリンク

### 優先度8: 月次集計の出勤日数カラム実装（コード動作保証）

**現状:** monthlySummary()関数のappendRowで出勤日数カラムが空文字 `""` のまま。

**方向性:**
- summary objectで出勤日数もカウントする変数を追加
- `summarySheet.appendRow([name, hours + "時間" + mins + "分", dayCount + "日"]);` のように修正

### 優先度9: 動作確認セクションの具体化

**現状:** トラブルシューティング表のみで、正常系の動作確認手順がない。

**方向性:**
- 冒頭に定義文追加（「動作確認とは、構築した勤怠管理Botが正しく動作するかをテストする作業です。」）
- テスト手順をステップで記述:
  1. Discordチャンネルで「出勤」と投稿
  2. スプレッドシートの「勤怠記録」シートに行が追加されたことを確認
  3. 数分後に「退勤」と投稿
  4. 退勤時刻と勤務時間が記録されたことを確認

## 保持すべき良い点
- GASコード3本（打刻受付・Discord通知・月次集計）の構成は実務的で段階的に理解しやすい
- 前提条件表が明確で必要環境がわかりやすい
- 機能一覧表（H2-1）が完成物のイメージを明確にしている
- トラブルシューティング表が実用的（4パターンのエラー対応）
- Layer 2→Layer 1ピラーへの冒頭導線が適切
- 敬体の完全統一
- APIキーのハードコードなし（PropertiesService使用）
- relatedArticlesが同カテゴリ2+別カテゴリ1のルール準拠

## 目標スコア
リファイン後の目標: 85点以上（SKIP判定水準）
