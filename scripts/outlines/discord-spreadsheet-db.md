# 記事ブリーフ: discord-spreadsheet-db（リライト）

## 基本情報

| 項目 | 内容 |
|------|------|
| slug | discord-spreadsheet-db |
| primary_kw | Discord スプレッドシートDB |
| secondary_kw | Discord データ管理, Discord Bot データベース |
| Layer | execution（Layer 2） |
| 記事タイプ | howto |
| クラスター | discord-bot |
| 想定文字数 | 3,000〜5,000文字 |
| ターゲット読者 | 中小企業の事務担当者・エンジニア初学者で、Discord Botにデータ管理機能を追加したい人 |
| difficulty | intermediate |
| timeToRead | 15 |
| totalTime | PT60M |

## 現状記事の課題

| 課題 | 詳細 |
|------|------|
| 文字数不足 | 約400文字。目標3,000〜5,000文字に対して大幅に不足 |
| SPREADSHEET_IDハードコード | `SpreadsheetApp.openById('SPREADSHEET_ID')` で文字列リテラル直書き |
| エラーハンドリングなし | try-catchなし、null確認なし |
| PING/PONG未実装 | doPostにtype 1の処理がない |
| CRUDが不完全 | Read/Createのみ。Update/Deleteなし |
| LockServiceなし | 同時書き込み対策がない |
| 表が1個のみ | 品質ルール違反（2個以上必要） |
| 内部リンク0本 | 本文中に関連記事へのリンクが0本 |
| 定義文なし | 各H2冒頭に定義がない |
| description不足 | 約68文字。120-160文字の範囲外 |
| titleにprimary_kwが不明確 | 「Discord スプレッドシートDB」が含まれていない |
| FAQ回答が薄い | 3個で各1-2文。5個で各2-4文が必要 |
| ピラーリンクなし | howto記事冒頭のLayer 1導線がない |
| 前提条件テーブルなし | howtoテンプレートの必須要素が欠落 |

## 競合分析サマリ

### 上位5記事

| # | 記事 | 深さ | 鮮度 | 独自性 | 弱点 |
|---|------|------|------|--------|------|
| 1 | Zenn（yuzmidori・収支管理Bot） | コード豊富 | 2021/01 | DM経由収支入力 | Python実装、Update/Deleteなし、LockServiceなし |
| 2 | RTAGamers（ノルマ管理Bot） | GitHub参照 | 2022/10 | 120人規模大会事例 | ドメイン特化、汎用設計なし |
| 3 | 虎の穴ラボ（スケジュール調整） | コード付き | 2024/12 | 企業技術ブログ | GAS Webhook一方向、Read onlyで書き込みなし |
| 4 | Discord-media（初心者ガイド） | 概念のみ | 2025/11 | Zapier/IFTTT比較 | コード例ゼロ、実装不可能 |
| 5 | note（Googleスプレッドシートへアクセス） | コード中程度 | 2024/04 | Discord.js v14 | Node.js実装、GASではない |

### 必須トピック（3記事以上でカバー）
- スプレッドシートへのデータ書込（Create）
- スプレッドシートからのデータ読込（Read）
- Discord Botとの基本接続

### 差別化チャンス（1-2記事のみカバー）
- カラム設計のベストプラクティス（ID列、タイムスタンプ）
- 日付ベースの検索ロジック（1記事のみ）
- 排他制御の言及（FAQ内で概念のみ、実装ゼロ）

### 独自トピック候補（どの記事もカバーなし）
- LockServiceによる排他制御の実装（全競合ゼロ）
- Update操作（既存データの更新）— 全競合ゼロ
- Delete操作（データの削除）— 全競合ゼロ
- 入力バリデーション設計（型チェック・範囲チェック）
- カラム設計パターン（ID列・タイムスタンプ・インデックス）
- エラーハンドリングの体系的実装
- スプレッドシートDB vs 本格DBの判断基準表

## 差別化ポイント

| パターン | 採用 | 根拠 |
|---------|------|------|
| 実装コード差別化 | **採用** | LockServiceによる排他制御とCRUD全操作を実装。全競合がCreate/Readのみで停止 |
| 実務経験差別化 | **採用** | 中小企業向けの在庫管理ユースケース。競合は収支管理やゲーム用途 |
| 網羅性差別化 | **採用** | カラム設計テーブル、スプレッドシートDB vs 本格DB比較表、トラブルシューティング表 |
| 構造化差別化 | **採用** | 前提条件テーブル、メリデメ比較表、制限事項表で構造化 |

## 見出し構成案

### H2-1: この記事で作るもの（完成イメージ）
- DiscordスプレッドシートDBの定義
- スプレッドシートDBと本格DBの比較表（メリット/デメリット/向き不向き）
- 完成時にできること3点（データ登録・照会・排他制御付き書き込み）
- 前提条件テーブル

### H2-2: 準備・環境構築
- スプレッドシートのカラム設計（ID列、データ列、タイムスタンプ列）
- GASプロジェクト作成・スクリプトプロパティ（SPREADSHEET_ID, DISCORD_BOT_TOKEN等）
- 準備項目テーブル

### H2-3: 実装手順
- ステップ1: データ読み取り（Read — ID検索 or 全件取得）
- ステップ2: データ追加（Create — 自動採番ID + LockServiceによる排他制御）
- ステップ3: doPostハンドラー（スラッシュコマンドルーティング）

### H2-4: 動作確認・トラブルシューティング
- テスト手順
- よくあるエラー表（6行）

### H2-5: 応用・カスタマイズ例
- 中小企業向けDiscordデータ管理シナリオ3選
- スプレッドシートDBの制限事項表
- 本格DB移行の判断基準

## FAQ案（5問）

| # | 質問 | 回答の方向性 |
|---|------|------------|
| 1 | スプレッドシートをデータベースとして使うのは安全ですか？ | 小規模データ管理には十分。機密情報はアクセス権限を設定。スクリプトプロパティでIDを管理し、シートの共有範囲に注意 |
| 2 | スプレッドシートDBの同時書き込みは大丈夫ですか？ | LockServiceで排他制御が可能。この記事のコードで実装済み。高頻度アクセスが続く場合は本格DBを検討 |
| 3 | データ量が増えた場合の対処法は？ | スプレッドシートは約500万セルが上限。数千行なら問題なし。1万行を超える場合はシート分割やCloud Firestoreへの移行を検討 |
| 4 | Discord BotデータベースにスプレッドシートよりCloud Firestoreを使うべき？ | 数百〜数千行ならスプレッドシートで十分。リアルタイム同期・大量データ・高頻度アクセスが必要ならFirestoreが適切 |
| 5 | スプレッドシートDBのバックアップはどうしますか？ | Googleドライブの版の管理（バージョン履歴）で過去のデータを復元可能。定期的にスプレッドシートをコピーして別ファイルにバックアップすることも有効 |

## 内部リンク候補

| リンク先 | 種別 | 配置場所 |
|---------|------|---------|
| gas/gas-basics | GASピラー | 冒頭導線 + まとめ |
| discord-bot/discord-bot-gas | 同カテゴリ | H2-5 |
| discord-bot/discord-slash-commands | 同カテゴリ | H2-3 doPost解説 |
| gas/gas-spreadsheet-automation | 別カテゴリ | H2-3 スプレッドシート操作 |

## ライターへの指示

1. **SPREADSHEET_IDはスクリプトプロパティ管理必須**: `PropertiesService.getScriptProperties().getProperty('SPREADSHEET_ID')` を使用。ハードコード禁止
2. **全コードにtry-catch + エラーメッセージ**: 全競合が欠落している差別化ポイント
3. **LockServiceによる排他制御を含める**: `LockService.getScriptLock()` でデータ書き込み時の同時アクセス対策。全競合で完全欠落しており最大の差別化
4. **カラム設計を明示**: ID列（自動採番）、データ列、タイムスタンプ列のパターンを示す
5. **doPost実装はdiscord-slash-commandsと整合性を取る**: 同クラスターの既存記事でdoPostパターンが確立済み
6. **discord-botクラスターにはピラー記事がないため**: 冒頭導線はgas/gas-basicsへのリンクとする
7. **表を最低3つ**: スプレッドシートDB比較、準備項目/カラム設計、トラブルシューティング
